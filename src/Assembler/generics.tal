(
@|generics )

@<assemble> ( -- )
  ( scan ) #01 handle-pass
  ( make #00 handle-pass )
  ( <write-rom> )
  ( <write-sym> )
  !<print-summary>

@handle-pass ( scan -: Error )
  ;scan STA
  ;heap-ptr LDA2 <set-heap-ptr>
  handle-input JMP2r

@handle-input ( str* -- )
  ;input
  &loop ( str* -- )
    LDAk handle-char
    INC2 LDAk ?&loop
  NL handle-char
  POP2 JMP2r

@handle-char ( c -- )
  ;token store-key ?{ JMP2r }
  ;token/buf DUP2 parse-token !<sclr>
